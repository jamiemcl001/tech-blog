<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>

  <title>Communicating between Docker Containers, the Host Machine etc.!</title>
  <meta name='description' content="Hi all,">
  <link rel='canonical' href="https://type-jekyll.aspirethemes.com//docker,/containers,/networking/2019/11/16/docker-inter-container-communication/">
  <link rel='alternate' type='application/rss+xml' title='Jamie McLeish's Blog - Tech Ramblings' href="https://type-jekyll.aspirethemes.com//feed.xml">

  <style>
    

    html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:0.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body,h1,h2,h3,h4,h5,h6,blockquote,p,pre,dl,dd,ol,ul,figure,hr,fieldset,legend{margin:0;padding:0}li>ol,li>ul{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}address,h1,h2,h3,h4,h5,h6,blockquote,p,pre,dl,ol,ul,figure,hr,table,fieldset{margin-bottom:32px}dd,ol,ul{list-style-position:inside;margin-left:16px}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#0088cc}.highlight{margin:0;background:#fff}.highlighter-rouge .highlight{background:#FAFAFA}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}body{color:#323232;font-size:19px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:32px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*::selection{color:#fff;background:#00A0FF}a{text-decoration:none;color:#323232;transition:.4s}a:hover,a:active,a:focus{text-decoration:underline}img{display:block;max-width:100%;font-style:italic}hr{height:1px;margin:32px 0;border:0;background-color:#E9EFF3}h1,h2,h3,h4,h5,h6{font-weight:inherit;line-height:initial;font-weight:600}h1{font-size:36px}h2{font-size:28px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}blockquote{padding-left:16px;border-left:3px solid #2B5F72}pre,code{font-family:Courier,monospace;background-color:#FAFAFA}pre{overflow:auto;padding:32px;margin-bottom:16px;font-size:16px;line-height:25px;white-space:pre;word-wrap:break-word}li code,p code{padding:4px 8px}input[type='text'],input[type='tel'],input[type='number'],input[type='email'],select,textarea{width:100%;padding:16px;border:1px solid #E9EFF3;border-radius:0;outline:none;background-color:#fff;font-size:14px;appearance:none;transition:.4s}input[type='text']:hover,input[type='text']:active,input[type='text']:focus,input[type='tel']:hover,input[type='tel']:active,input[type='tel']:focus,input[type='number']:hover,input[type='number']:active,input[type='number']:focus,input[type='email']:hover,input[type='email']:active,input[type='email']:focus,select:hover,select:active,select:focus,textarea:hover,textarea:active,textarea:focus{border:1px solid #323232}.o-grid{margin:0 auto;display:flex;flex-wrap:wrap;max-width:700px}.o-grid:after{content:'';display:table;clear:both}.o-grid .o-grid{margin-right:-16px;margin-left:-16px;padding:0}.o-grid--full{max-width:100vw}.o-grid__col{float:left;padding-right:16px;padding-left:16px}.o-grid__col--1-4-s{width:25%}.o-grid__col--1-3-s{width:33.3333333333%}.o-grid__col--2-4-s{width:50%}.o-grid__col--3-4-s{width:75%}.o-grid__col--4-4-s{width:100%}@media (min-width: 40em){.o-grid__col--1-4-m{width:25%}.o-grid__col--1-3-m{width:33.3333333333%}.o-grid__col--2-4-m{width:50%}.o-grid__col--3-4-m{width:75%}}@media (min-width: 64em){.o-grid__col--1-4-l{width:25%}.o-grid__col--1-3-l{width:33.3333333333%}.o-grid__col--2-4-l{width:50%}.o-grid__col--3-4-l{width:75%}}.o-grid__col--full{width:100%}.o-grid__col--center{margin:0 auto}.o-grid__col--end{margin-left:auto}.o-wrapper{padding:32px 0}.c-off-canvas-container{display:flex;min-height:100vh;flex-direction:column}.c-off-canvas-container .o-wrapper{flex:1 0 auto}.o-plain-list{margin:0;padding:0;list-style:none}.c-header__inner{padding:16px 0;border-bottom:1px solid #E9EFF3}.c-header__icon{vertical-align:middle}.c-logo__link{font-size:19px;font-weight:900;transition:.4s}.c-logo__link:hover,.c-logo__link:active,.c-logo__link:focus{color:#00A0FF;text-decoration:none}.c-nav__item{font-size:16px}.c-nav__link{display:block;transition:.4s}.c-nav__link--current{color:#00A0FF}.home-template .c-nav__link--current:not(:hover){color:#323232}.c-nav__link:hover,.c-nav__link:active,.c-nav__link:focus{color:#00A0FF;text-decoration:none}.c-off-canvas-toggle{float:right;position:relative;top:8px;z-index:10;height:19px;width:25px;cursor:pointer}.c-off-canvas-toggle__icon{position:absolute;left:0;height:1px;width:25px;background:#323232;cursor:pointer}.c-off-canvas-toggle__icon:before,.c-off-canvas-toggle__icon:after{content:'';display:block;height:100%;background-color:inherit;transition:.4s}.c-off-canvas-toggle__icon:before{transform:translateY(16px)}.c-off-canvas-toggle__icon:after{transform:translateY(7px)}.c-off-canvas-toggle--close .c-off-canvas-toggle__icon{height:2px;background-color:transparent}.c-off-canvas-toggle--close .c-off-canvas-toggle__icon:before,.c-off-canvas-toggle--close .c-off-canvas-toggle__icon:after{position:relative;visibility:visible;background:#323232}.c-off-canvas-toggle--close .c-off-canvas-toggle__icon:before{top:11px;transform:rotate(-45deg)}.c-off-canvas-toggle--close .c-off-canvas-toggle__icon:after{top:9px;transform:rotate(45deg)}.c-off-canvas-toggle--close{top:0;float:none;display:block;margin-left:auto}html,body{overflow-x:hidden}.c-off-canvas-content{position:fixed;top:0;right:0;width:300px;height:100%;padding:24px 32px;background-color:#fff;transform:translate3d(300px, 0, 0)}.c-off-canvas-container{transform:translate3d(0, 0, 0);transition:transform .4s cubic-bezier(0.16, 0.68, 0.43, 0.99)}.c-off-canvas-container.is-active{transform:translate3d(-300px, 0, 0)}.c-off-canvas-container.is-active:after{position:fixed;top:0;right:0;bottom:0;left:0;content:'';background-color:rgba(0,0,0,0.2)}.c-tags a{display:inline-block;padding:4px 16px;margin:0 8px 4px 0;font-size:12px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:25px;background-color:#FAFAFA;transition:.4s}.c-tags a:hover,.c-tags a:active,.c-tags a:focus{text-decoration:none;background-color:#FAFAFA}@media (max-width: 39.99em){.c-tags{margin-bottom:22px}}.c-btn{display:inline-block;padding:8px 32px;cursor:pointer;transition:.4s;text-align:center;vertical-align:middle;white-space:nowrap;line-height:inherit;border:0;border-radius:0;color:#fff;background-color:#207cdf;font-size:16px}.c-btn:hover,.c-btn:active,.c-btn:focus{text-decoration:none;background-color:#238cf6}.c-btn--full{width:100%}.c-btn--small{padding:4px 16px}.c-post-card{display:block;padding:32px 0;word-break:break-word;border-bottom:1px solid #E9EFF3}.c-post-card--first{padding-top:0}.c-post-card--last{padding-bottom:0;border-bottom:0}.c-post-card__title{margin-bottom:10px;font-size:19px;font-weight:600;transition:.4s}@media (min-width: 40em){.c-post-card__title{font-size:28px}}.c-post-card__excerpt{margin-bottom:10px}.c-post-card__date{display:block;color:#2B5F72;direction:ltr;font-size:12px;font-weight:600;line-height:22px;text-transform:uppercase}.c-post-card:hover{color:#323232;text-decoration:none}.c-post-card:hover .c-post-card__title{color:#00A0FF}.c-pagination{text-transform:uppercase;transition:.4s}.c-pagination:hover,.c-pagination:active,.c-pagination:focus{color:#00A0FF;text-decoration:none}.c-pagination__text{position:relative;font-size:14px;letter-spacing:2px}.c-pagination__text--prev{left:-16px}.c-pagination__text--next{right:-16px}.c-pagination__icon{vertical-align:text-top}.c-pagination__icon--prev{left:-8px}.c-pagination__icon--next{right:-8px}.c-post{margin:0 auto;max-width:740px}.c-post__title{font-size:24px;margin-bottom:16px}@media (min-width: 40em){.c-post__title{font-size:28px}}.c-post__date{position:relative;padding-top:16px;display:block;text-align:center;margin-bottom:16px;font-size:14px;font-weight:600;line-height:22px;color:#2B5F72}.c-post__date:after{position:absolute;content:'';top:0;left:50%;height:1px;width:64px;background:#FAFAFA;transform:translateX(-50%)}.c-post__image{margin:0 auto 16px}.c-content a:not(.c-btn){text-decoration:underline;text-decoration-skip:ink}.c-content a:not(.c-btn):hover,.c-content a:not(.c-btn):active,.c-content a:not(.c-btn):focus{color:#00A0FF}.twitter-tweet,.fluid-width-video-wrapper{margin-bottom:16px !important}.c-social-nav__item{display:inline-block}.c-social-nav__icon{fill:#323232;vertical-align:middle;transition:.4s}.c-social-nav__icon:hover,.c-social-nav__icon:active,.c-social-nav__icon:focus{fill:#00A0FF}.c-footer{padding:32px 0;background-color:#FAFAFA}.u-hidden{display:none}.u-hidden-visually{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.u-font-medium{font-size:16px;line-height:25px}.u-font-small{font-size:14px;line-height:22px}.u-font-tiny{font-size:12px;line-height:19px}.u-text-left{text-align:left}.u-text-right{text-align:right}.u-text-center{text-align:center}.u-text-justify{text-align:justify}.u-inline{display:inline}.u-block{display:block}.u-inline-block{display:inline-block}.u-left{float:left}.u-right{float:right}.u-clearfix:after{content:'';display:table;clear:both}

  </style>
</head>

<body>

  <!-- Google Analytics Code -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152720365-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-152720365-1');
</script>
<!-- End Google Analytics Code -->

  <div class='js-off-canvas-container c-off-canvas-container'>
    <header class='c-header'>

  <div class='o-grid'>
    <div class='o-grid__col o-grid__col--full'>
      <div class='c-header__inner'>

        <div class='o-grid'>
          <div class='o-grid__col o-grid__col--3-4-s'>
            <div class='c-logo u-text-left'>
              <a class='c-logo__link' href='/'>Jamie McLeish's Blog - Tech Ramblings</a>
            </div>
          </div>

          <div class='o-grid__col o-grid__col--1-4-s'>
            <label class='js-off-canvas-toggle c-off-canvas-toggle' aria-label='Toggle navigation'>
              <span class='c-off-canvas-toggle__icon'></span>
            </label>
          </div>

          <div class='o-grid__col o-grid__col--1-4-s'>
            <div class='c-off-canvas-content'>
              <label class='js-off-canvas-toggle c-off-canvas-toggle c-off-canvas-toggle--close'>
                <span class='c-off-canvas-toggle__icon'></span>
              </label>

              <ul class='c-nav o-plain-list '>
                
  

  
    
  

  
    
  

              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</header>

    



<div class='o-wrapper'>

  <div class='o-grid'>
    <div class='o-grid__col'>
      <article class='c-post' itemscope itemtype='http://schema.org/BlogPosting'>

        <h1 class='c-post__title u-text-center'>Communicating between Docker Containers, the Host Machine etc.!</h1>

        <time class='c-post__date' datetime='2019-11-16T15:39:00+00:00' itemprop='datePublished'>16 Nov 2019</time>

        <div class='c-content' itemprop='articleBody'>
          

          <p>Hi all,</p>

<p>During our time at work we recently came across an issue when using LocalStack for testing. We had two containers spun up as part of a <code class="highlighter-rouge">docker-compose</code> stack, and needed to be able to communicate between the two containers. After spending some time looking through StackOverflow we realised where we were going wrong. Thus - the inspiration for this blog post (the first on my new tech blog 🎉) was born.</p>

<p>Rather than using this example throughout the post I’ll simplify it even further to demonstrate. Say, for example, I have a simple Express server running on port 8080 of my local machine. When I make a GET request to the endpoint <code class="highlighter-rouge">/say-hello</code> with a name passed as a query parameter, I want to be nice and say hello to the fine person. But what happens if I want to move the app over to execute on another host machine? Let’s say that we have been developing and running the server on a *NIX based machine and we needed to migrate over to run this on a Windows machine? In this simplistic example we wouldn’t expect to see any problems when we try run our app - but what if we were developing something much more complex than a simple server? We could easily run into issues that may only be encountered in a specific Operating System. So… Docker to the rescue. For anyone that hasn’t played around with Docker as yet, it basically provides users with the ability to run commands/applications in a completely containerised environment - something that should make the different operating systems problem a thing of the past.</p>

<p>Listed above is just one of the many advantages of running our applications in a containerised environment - and if we start to run multiple containers alongside each other, we may want to be able to communicate between those - how do we do this? This article covers the following scenarios:</p>

<ul>
  <li><strong>Communicating with a Docker container from the host machine</strong></li>
  <li><strong>Communicating with the host machine from inside a Docker container</strong></li>
  <li><strong>Communicating with another Docker container from inside a Docker container</strong></li>
</ul>

<p>Let’s begin…</p>

<h3 id="communicating-with-a-docker-container-from-the-host-machine"><strong>Communicating with a Docker container from the host machine:</strong></h3>

<p>If you clone <a href="https://github.com/jamiemcl001/say-hello-server">this repository</a>, and run the command <code class="highlighter-rouge">docker build -t sample-node .</code>, you will be able to run a container with this image. We will be using this image throughout the course of this blog post. Running the image in a newly constructed container is simple with the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:8080 sample-node
</code></pre></div></div>

<p>The magic behind being able to connect to this container is the <code class="highlighter-rouge">-p 8080:8080</code> parameter. When used, this parameter will automatically map port 8080 of the docker container to port 8080 on your local machine. If you would rather use the standard port 80 to make requests then you could use the parameter, such as <code class="highlighter-rouge">-p 80:8080</code>. This will map port 80 of your localhost to port 8080 of the docker container.</p>

<p>With the previous commands being run - the local machine should be able to communicate directly with the docker host using the <code class="highlighter-rouge">localhost</code> name. Running <code class="highlighter-rouge">curl localhost:8080/say-hello?name=John</code> should result in you seeing <code class="highlighter-rouge">Hello, John</code> in the terminal. Hooray!</p>

<h3 id="communicating-with-the-host-machine-from-inside-a-docker-container"><strong>Communicating with the host machine from inside a Docker container:</strong></h3>

<p>Unfortunately this way is much more tricky and not standard between different operating systems, although the use cases for it are more limited than, say, container &lt;-&gt; container communication and host machine -&gt; container communication. I’ll detail the technique required for OSX, as this is what I readily have access to, although I will update with a technique for Linux and Windows in due course.</p>

<p><strong>Working with OSX</strong></p>

<p>Docker can automatically resolve the hostname <code class="highlighter-rouge">docker.for.mac.host.internal</code> when we run containers using the default bridge network. As such I can run the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -ti alpine /bin/sh
apk add curl
curl docker.for.mac.host.internal:8080/say-hello?name=John
</code></pre></div></div>

<p>If I want to do the same but with an easier to remember hostname (remembering to type out <code class="highlighter-rouge">docker.for.mac.host.internal</code> every time could become quite cumbersome then I can execute the following command to provide the hostname <code class="highlighter-rouge">local</code> instead.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-ti</span> <span class="nt">--name</span> sample_app <span class="nt">--add-host</span> <span class="nb">local</span>:<span class="k">$(</span>ipconfig getifaddr en0<span class="k">)</span> alpine /bin/sh
apk add curl
curl <span class="nb">local</span>:8080/say-hello?name<span class="o">=</span>John
</code></pre></div></div>

<p>Both examples listed above should result in the response <code class="highlighter-rouge">Hello, John!</code> being shown in the terminal.</p>

<p>For context, the <code class="highlighter-rouge">--add-host</code> parameter will automatically add a record into the <code class="highlighter-rouge">/etc/hosts</code> file of the container. This essentially means that if you use the command <code class="highlighter-rouge">--add-host local:192.16.0.2</code>, then inspect the value of the hosts file - you should see something along the lines of the following:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
192.16.0.2 <span class="nb">local
</span>172.17.0.3      3c6f479965ad
</code></pre></div></div>

<p>Therefore, when you make requests to <code class="highlighter-rouge">local</code> - the machine will first look in this file - find an associated record for the hostname <code class="highlighter-rouge">local</code> and therefore redirect the request to <code class="highlighter-rouge">192.16.0.2</code> without needing to go to the external network.</p>

<p>Please note that this is tested using OSX Catalina - unfortunately I don’t have access to an earlier version of OSX to test if the <code class="highlighter-rouge">ipconfig getifaddr en0</code> works as expected, if it doesn’t then please do let me know and I’ll try and document a more reliable method. This command, when executed directly in the terminal will echo the local network’s IP address for your machine. <em>There could be other network interfaces that you may need to check for in order to get this working. If anyone has a nicer way of retrieving the local IP of your machine then please mention them in the comments.</em></p>

<p><strong>Working with Linux</strong></p>

<p><em>Disclaimer: I’ve only tested this with an earlier version of Fedora (Fedora 27 to be exact) but I believe it should work on other Linux based OS’es. If anyone should encounter any issues then please let me know and I’ll update the post with the appropriate method.</em></p>

<p>Running Docker in Linux seems a little less fiddly than using it with OSX. The reason for this is that the <code class="highlighter-rouge">--network host</code> parameter works as you’d expect it to. If we begin by running our server on our local machine (<code class="highlighter-rouge">node src/server.js</code>), we can then easily allow our future containers to be able to communicate with it. Let’s launch a new container using the super minimal <code class="highlighter-rouge">alpine</code> image.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-ti</span> <span class="nt">--network</span> host alpine
apk add curl
curl localhost:8080/say-hello?name<span class="o">=</span>John
</code></pre></div></div>

<p>Now we should see the message <code class="highlighter-rouge">Hello John!</code> echoed back to us. See - much simpler than what we had to go through on OSX.</p>

<p><strong>Working with Windows</strong></p>

<p>Unfortunately I haven’t had a chance to test the approaches required on Windows. Apologies for this - I’ll check this shortly and update the post with the appropriate method.</p>

<h3 id="communicating-with-another-docker-container-from-inside-a-docker-container"><strong>Communicating with another Docker container from inside a Docker container:</strong></h3>

<p>There are a few different ways of doing this, and I’ll document my preferred approach: using a custom Docker network.</p>

<p><strong>Using a custom network:</strong></p>

<p>Lets begin by creating a new network in Docker. This post will not go into much detail about how networking works in Docker - although if we simply create a new network we can look at it as creating a sub-network that Docker will manage and allow containers to connect to.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create private_network
</code></pre></div></div>

<p>With this command we have created a private bridge network named <code class="highlighter-rouge">private_network</code> in Docker. Containers that are attached to this network will be able to communicate with each other as if they are on their own private LAN. This is a really nice feature of Docker and something that I’ll definitely be looking further into and discussing in the future.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">--name</span> sample-node <span class="nt">--network</span> private_network sample-node
</code></pre></div></div>

<p>If we deconstruct this command - we are creating a container as we usually would do - but we are also adding the <code class="highlighter-rouge">--network private_network</code> parameter. This tells Docker to attach this newly running container to the private bridge network when it is launched. We can do this by running the command <code class="highlighter-rouge">docker network inspect private_network</code></p>

<p>If you look at the output of this command, you should see a lot of the networks internals - but the thing that we are particularly interested in is the <code class="highlighter-rouge">Containers</code> object. This lists any containers that are currently attached to this internal network. At this point we should only see one container listed in this response - our newly created <em>sample-node</em> container.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="s2">"Containers"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"6ab48ccea7334c0dbc6469f5d0fa78ac9522ef2b806c25dd91beb22792143447"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"sample-node"</span><span class="p">,</span>
            <span class="s2">"EndpointID"</span><span class="p">:</span> <span class="s2">"..."</span><span class="p">,</span>
            <span class="s2">"MacAddress"</span><span class="p">:</span> <span class="s2">"..."</span><span class="p">,</span>
            <span class="s2">"IPv4Address"</span><span class="p">:</span> <span class="s2">"172.20.0.2/16"</span><span class="p">,</span>
            <span class="s2">"IPv6Address"</span><span class="p">:</span> <span class="s2">""</span>
        <span class="p">}</span>
    <span class="p">},</span>
</code></pre></div></div>

<p>This output essentially means that if any other containers should connect to the network - they will also be able to see others connected. We can demonstrate this by launching a throwaway container on the same network (<code class="highlighter-rouge">docker run -ti --rm --network private_network alpine /bin/sh</code>) and pinging <code class="highlighter-rouge">172.20.0.2</code>, seeing the following output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PING 172.20.0.2 <span class="o">(</span>172.20.0.2<span class="o">)</span>: 56 data bytes
64 bytes from 172.20.0.2: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.320 ms
</code></pre></div></div>

<p>Docker also allows us to connect to other containers on the same network by their Container ID and their Container name. As a result, this makes it much easier for us to be able to communicate between them. This will mean that the docker bridge will resolve <code class="highlighter-rouge">sample-node</code> to <code class="highlighter-rouge">172.20.0.2</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-ti</span> <span class="nt">--network</span> private_network alpine /bin/sh
apk add curl
curl sample-node:8080/say-hello?name<span class="o">=</span>John
</code></pre></div></div>

<p>And we should see <code class="highlighter-rouge">Hello John</code> in our terminal output! 🎉🎉🎉</p>

<p>If users wish to use <code class="highlighter-rouge">docker-compose</code> instead of the Docker CLI to construct the containers then I’ll also provide a <code class="highlighter-rouge">docker-compose.yml</code> file that can be used to demonstrate the same approach:</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "3.7"

services:
    sample-node:
    image: sample-node
    container_name: sample-node
    networks:
        - default
    alpine:
    image: alpine
    container_name: alpinetest
    depends_on:
        - sample-node
    tty: true
    networks:
        - default

networks:
    default:
</code></pre></div></div>

<p>Running <code class="highlighter-rouge">docker-compose up -d</code> will start both of these containers and place them onto the same network on launch. Using the empty network object <code class="highlighter-rouge">default</code> empty will create a new bridge network automatically and attach both containers to it on launch, while using the <code class="highlighter-rouge">-d</code> parameter in docker-compose will launch all containers in detached mode. First off lets check that both containers are running as expected with the command <code class="highlighter-rouge">docker ps</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                  NAMES
e4a73515163c        alpine                 <span class="s2">"/bin/sh"</span>                7 hours ago         Up 7 hours                                 alpinetest
3e682b2adb74        sample-node            <span class="s2">"node server.js"</span>         7 hours ago         Up 7 hours          8080/tcp               sample-node
</code></pre></div></div>

<p>As we can tell from the output above, we have both containers running as expected, and we can move on to try executing commands within these containers. We can gain access to them by using the name we defined in <code class="highlighter-rouge">container_name</code> for each object. As such - lets gain access to the default shell in the <code class="highlighter-rouge">alpine</code> image, just to check that we can resolve the server as expected:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-ti</span> sample-node /bin/sh
apk add curl
curl sample-node:8080/say-hello?name<span class="o">=</span>John
</code></pre></div></div>

<p>And we see our “Hello John” output, as expected! 🤯🤯🤯</p>

<p>By this point I feel that we’ve got a good enough understanding of how we can communicate between containers, as well as communicating with the host machine as well. This weekend has been eye opening to just how powerful Docker is and how we can use it for more things in our everyday work environment and I’ll certainly be taking the time to learn more about it. I’ll try and ensure that whenever something interesting does crop up - I’ll try and write it up for future reference. I do hope that you found this article interesting and it has given you the opportunity to learn something new about Docker. I look forward to putting together the next blog post for this site.</p>

<p>Thanks,</p>

<p>Jamie.</p>

        </div>

        <div class='c-tags'>
          
        </div>

      </article>

    </div>
  </div>
</div>

    <footer class='c-footer'>
  <div class='o-grid'>
    <div class='o-grid__col o-grid__col--full'>

      <ul class='o-plain-list c-social-nav u-text-center'>
        <li class='c-social-nav__item'>
          <a href='https://twitter.com/jamie_mcleish' target='_blank'>
            <span class='c-social-nav__icon' data-icon='ei-sc-twitter' data-size='s'></span>
          </a>
        </li>
        <li class='c-social-nav__item'>
          <a href='https://www.facebook.com/jamiemcleish' target='_blank'>
            <span class='c-social-nav__icon' data-icon='ei-sc-facebook' data-size='s'></span>
          </a>
        </li>
        <li class='c-social-nav__item'>
          <a href='https://www.instagram.com/jamie_mcleish91/' target='_blank'>
            <span class='c-social-nav__icon' data-icon='ei-sc-instagram' data-size='s'></span>
          </a>
        </li>
        <li class='c-social-nav__item'>
          <a href='https://github.com/jamiemcl001' target='_blank'>
            <span class='c-social-nav__icon' data-icon='ei-sc-github' data-size='s'></span>
          </a>
        </li>
        <li class='c-social-nav__item'>
          <a href='mailto:jamie@jamiemcl.tech' target='_blank'>
            <span class='c-social-nav__icon' data-icon='ei-envelope' data-size='s'></span>
          </a>
        </li>
      </ul>

    </div>
  </div>
</footer>
  </div>

  <script src="/js/jquery-3.1.1.min.js"> </script>
  <script src="/js/evil-icons.min.js">   </script>
  <script src="/js/jquery.fitvids.js">   </script>
  <script src="/js/app.js">              </script>
</body>

</html>